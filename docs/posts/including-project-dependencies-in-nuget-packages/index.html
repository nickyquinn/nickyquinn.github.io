<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-US-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nick Quinn — Including same-solution project dependencies in NuGet packages</title>
    <link href="/assets/style/base.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Manrope:wght@300;400;700&display=swap" rel="stylesheet">
    
    
    <meta property="og:title" content="">
    <meta property="og:description" content="The home of Nick Quinn - full stack developer">
    <meta property="og:type"  content="website">
    <meta property="og:url"   content="/posts/including-project-dependencies-in-nuget-packages/">

    

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      if(localStorage.getItem("consentMode") === null) {
        gtag('consent', 'default', {
          'ad_storage': 'denied',
          'analytics_storage': 'denied'
        });
      } else {
        gtag("consent", "default", JSON.parse(localStorage.getItem("consentMode")));
      }
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M98D584C');</script>
    <!-- End Google Tag Manager -->
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M98D584C"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="wrapper">
    <header>
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="site-title">
              <a href="/">Nick Quinn</a>
              
            </div>
            <nav area-label="main">
              <ul>
                <li><a href="/about">About</a></li>
                <li><a href="/posts">Posts</a></li>
                <li><a href="/stuff">Stuff</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>

      
    </header>

    <main class="page-body">
        <article>
            
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="post_content">
                <h1>Including same-solution project dependencies in NuGet packages</h1>
<p>A regular pattern in .NET is to break software down into multiple projects within a Visual Studio solution; this helps developers visually identify separation of concerns, but it also allows parts of the code base to be different project types or languages. Another common reason may be that a solution produces more than one resulting piece of software, such as a web frontend, and an API for that frontend; in this scenario, you may have <em>three or more</em> projects: the web project, the API project, and one or more library project containing code that's shared between the first two - these additional library projects may include things such as DTOs or &quot;data transfer objects&quot; - objects whose only purpose is to carry data between processes. When each project is built, each gets a copy of any shared library DLLs.</p>
<p>But what if one of your published outputs is a NuGet package? Things work differently here: NuGet packages do not automatically get bundled with their shared library projects, and viewing the nupkg file will reveal that it has a dependency on these projects, and that you're expected to provide them, potentially as separate NuGet packages. This is fine if you want this behaviour, but what if you don't?</p>
<p>In the below screenshot I've set up a three-project solution: the first is the NuGet package project, the middle is a shared project the NuGet package project will have a dependency on, and the SampleNugetConsumer is what I'll attempt to install the resulting NuGet package from the first project into:</p>
<p><img src="/assets/images/posts/nuget-project-dependencies/the_nuget_sample_project.webp" alt="Set up of the example NuGet project"></p>
<p>If I build this project, and look at the information for the NuGet package in the NuGet package manager, it tells me that this package has a dependency on SampleNuget.Shared:</p>
<p><img src="/assets/images/posts/nuget-project-dependencies/nuget_with_dependencies.webp" alt="NuGet package manager showing the package with NuGet dependencies"></p>
<p>Trying to install this NuGet package results in an error, because the dependent package is not available:</p>
<p><img src="/assets/images/posts/nuget-project-dependencies/need_nuget_dependencies.webp" alt="Missing dependency error"></p>
<p>By making the following additions (in red) to the NuGet package's csproj file, the shared project will be built and the resulting DLL will be made part of the NuGet package, instead of an external dependency:</p>
<p><img src="/assets/images/posts/nuget-project-dependencies/changes_to_nuget_project.webp" alt="Missing dependency error"></p>
<p>Now when I try to install the NuGet package, the external dependency is gone, and I can install the package, which now includes the shared project code:</p>
<p><img src="/assets/images/posts/nuget-project-dependencies/dependency_free_nuget.webp" alt="Installable NuGet package with no external dependencies"></p>


                <div class="meta-text">Posted on Fri Mar 22 2024</span>
            </div>
        </div>
    </div>
</div>
        </article>
    </main>

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-12">
            © Nick Quinn 2021
            <a href="javascript:void(0);" onclick="showConsentBanner(); return false;">Manage cookies</a>
            <a href="/feed.xml">RSS</a>
          </div>
        </div>
      </div>
    </footer>

    <div id="cookie-consent-cover" class="cookie-consent-cover">
    </div>

    <div id="cookie-consent-banner" class="cookie-consent-banner">
      <div class="consent-content">
        <h3>Cookie settings</h3>
        <p>I'd like to set cookies so I can see who has visited the site and understand what content is interesting. The data I collect is anonymous. If that's okay with you press 'accept selection', or you can customise whcih cookies you agree to first.</p>
        
        
        <div class="cookie-consent-options">
          <label><input id="consent-necessary" type="checkbox" value="Necessary" checked disabled>Necessary</label>
          <label><input id="consent-analytics" type="checkbox" value="Analytics" checked>Analytics</label>
          
        </div>
        <button id="btn-accept-some" class="cookie-consent-button btn-outline">Accept Selection</button>
      </div>
    </div>
<script>
  
  function hideBanner() {
    document.getElementById('cookie-consent-banner').classList.remove('visible');
    document.getElementById('cookie-consent-cover').classList.remove('visible');
  }

  
    document.getElementById('btn-accept-some').addEventListener('click', function() {
      setConsent({
        necessary: true,
        analytics: document.getElementById('consent-analytics').checked,
        preferences: false,
        marketing: false
        //preferences: document.getElementById('consent-preferences').checked,
        //marketing: document.getElementById('consent-marketing').checked
      });
      hideBanner();
    });
    

  if(localStorage.getItem('consentMode') === null) {
    document.getElementById('cookie-consent-banner').classList.add('visible');
    document.getElementById('cookie-consent-cover').classList.add('visible');
  } else {
    hideBanner();
  }
  
  function setConsent(consent) {
    const consentMode = {
      'functionality_storage': consent.necessary ? 'granted' : 'denied',
      'security_storage': consent.necessary ? 'granted' : 'denied',
      'ad_storage': consent.marketing ? 'granted' : 'denied',
      'analytics_storage': consent.analytics ? 'granted' : 'denied',
      'personalization': consent.preferences ? 'granted' : 'denied',
    };
    gtag('consent', 'update', consent);  
    localStorage.setItem('consentMode', JSON.stringify(consentMode));
  }

  function showConsentBanner() {
    document.getElementById('cookie-consent-banner').classList.add('visible');
    document.getElementById('cookie-consent-cover').classList.add('visible');
  }
  
</script>

    </div>
  </body>
</html>